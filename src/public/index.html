<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Spec cookies</title>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
      }
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
      }
      button {
        margin: 10px;
      }
    </style>
  </head>
  <body>
    <h1 class="title">Spec Cookie</h1>
    <script class="ref">
      const $ = document.querySelector.bind(document)
      const ref = $('.ref')
      const ORIGIN_URL_REG = {
        main: /main\.domain\.com/,
        sub: /sub\.domain\.com/
      }
      const CROSS_SITE_EFFECT = {
        sub: 'https://main.domain.com:5000/set-cookie',
        main: 'https://sub.domain.com:5000/set-cookie'
      }
      const button = document.createElement('button')
      function http(url, method = 'get') {
        const xml = new XMLHttpRequest()
        xml.open(method, url, true)
        xml.send()
      }

      if (ORIGIN_URL_REG.main.test(location.origin)) {
        button.innerText = CROSS_SITE_EFFECT.main
        button.onclick = () => http(CROSS_SITE_EFFECT.main)
      } else if (ORIGIN_URL_REG.sub.test(location.origin)) {
        button.innerText = CROSS_SITE_EFFECT.sub
        button.onclick = () => http(CROSS_SITE_EFFECT.sub)
      } else {
        button.innerText = CROSS_SITE_EFFECT.main
        button.onclick = () => http(CROSS_SITE_EFFECT.main)
      }

      document.body.insertBefore(button, ref)
    </script>
  </body>
</html>
